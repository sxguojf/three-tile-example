import"./modulepreload-polyfill-3cfb730f.js";import{g as A}from"./lil-gui.module.min-a1e98589.js";import{b3 as P,ah as C,ai as E,aY as z,V as S,a2 as G,H,af as B,ae as T,i as f,f as I,b as W,m as _,a as x,b7 as q,b8 as V}from"./mapSource-ec449248.js";import{e as L,T as F}from"./tween.module-26270d87.js";import{G as O}from"./GLTFLoader-6352f6b2.js";import{c as D,a as N,l as R,f as j,d as J,b as U,s as K}from"./util-bfcdfc22.js";class Q extends P{constructor(o,e={}){const t=e.font;if(t===void 0)super();else{const s=t.generateShapes(o,e.size);e.depth===void 0&&(e.depth=50),e.bevelThickness===void 0&&(e.bevelThickness=10),e.bevelSize===void 0&&(e.bevelSize=8),e.bevelEnabled===void 0&&(e.bevelEnabled=!1),super(s,e)}this.type="TextGeometry"}}class Y extends C{constructor(o){super(o)}load(o,e,t,s){const a=this,i=new E(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(o,function(r){const p=a.parse(JSON.parse(r));e&&e(p)},t,s)}parse(o){return new Z(o)}}class Z{constructor(o){this.isFont=!0,this.type="Font",this.data=o}generateShapes(o,e=100){const t=[],s=$(o,e,this.data);for(let a=0,i=s.length;a<i;a++)t.push(...s[a].toShapes());return t}}function $(n,o,e){const t=Array.from(n),s=o/e.resolution,a=(e.boundingBox.yMax-e.boundingBox.yMin+e.underlineThickness)*s,i=[];let r=0,p=0;for(let u=0;u<t.length;u++){const g=t[u];if(g===`
`)r=0,p-=a;else{const m=X(g,s,r,p,e);r+=m.offsetX,i.push(m.path)}}return i}function X(n,o,e,t,s){const a=s.glyphs[n]||s.glyphs["?"];if(!a){console.error('THREE.Font: character "'+n+'" does not exists in font family '+s.familyName+".");return}const i=new z;let r,p,u,g,m,b,y,v;if(a.o){const d=a._cachedOutline||(a._cachedOutline=a.o.split(" "));for(let l=0,M=d.length;l<M;)switch(d[l++]){case"m":r=d[l++]*o+e,p=d[l++]*o+t,i.moveTo(r,p);break;case"l":r=d[l++]*o+e,p=d[l++]*o+t,i.lineTo(r,p);break;case"q":u=d[l++]*o+e,g=d[l++]*o+t,m=d[l++]*o+e,b=d[l++]*o+t,i.quadraticCurveTo(m,b,u,g);break;case"b":u=d[l++]*o+e,g=d[l++]*o+t,m=d[l++]*o+e,b=d[l++]*o+t,y=d[l++]*o+e,v=d[l++]*o+t,i.bezierCurveTo(m,b,y,v,u,g);break}}return{offsetX:a.ha*o,path:i}}const c=D(x,_),ee=new S(87.3,28.3,3),oe=new S(87.3,28.2,6),h=N("#map",c,ee,oe);R(h,c);c.receiveShadow=!0;h.renderer.shadowMap.enabled=!0;h.renderer.shadowMap.type=G;h.ambLight.intensity=.5;h.dirLight.intensity=.5;const k=new O;k.loadAsync("../model/Soldier.glb").then(n=>{ne(n),ae(n),se(n),te(n),re(n)});const te=n=>{const o=n.scene,e=new H(16777215,1);e.target=o,e.position.set(5,10,-5),e.castShadow=!0,e.shadow.camera.visible=!0;const t=e.shadow.camera;t.far=30,t.near=.1,t.left=-2,t.right=2,t.top=2,t.bottom=-2,o.add(e),h.scene.add(new B(e.shadow.camera))},ne=n=>{const o=n.scene;c.add(o),o.traverse(t=>{t.receiveShadow=!0,t.castShadow=!0}),o.scale.setScalar(.5);const e=new T(n.scene);ie(n,e),h.addEventListener("update",t=>{L.update(),e.update(t.delta)})},ae=n=>{const o=n.scene;k.loadAsync("../model/Stork.glb").then(e=>{const t=e.scene;t.scale.setScalar(.005),t.rotateY(Math.PI),t.traverse(a=>{a.castShadow=!0}),t.position.set(0,2,2),o.add(t);const s=new T(t);s.clipAction(e.animations[0]).play(),h.addEventListener("update",a=>{L.update(),s.update(a.delta)})})},se=n=>{new Y().load("../fonts/helvetiker_regular.typeface.json",function(e){const t=new Q("Hit Points 99.9%",{font:e,size:80,height:5,curveSegments:12,bevelEnabled:!0,bevelThickness:10,bevelSize:8,bevelSegments:5}),s=[new f({color:16777215,flatShading:!0}),new f({color:13421772})],a=new I(t,s);a.geometry.center(),a.scale.setScalar(.002),a.position.setY(2),a.rotation.set(0,Math.PI,0),n.scene.add(a)})},ie=(n,o)=>{const e=n.scene;let t=new F(e.position);h.container.addEventListener("click",s=>{var p;const a=h.camera,i=new W;i.x=s.clientX/h.container.clientWidth*2-1,i.y=1-s.clientY/h.container.clientHeight*2;const r=(p=c.getLocalInfoFromScreen(a,i))==null?void 0:p.point;r&&(t=ce(n,o,c.worldToLocal(r.clone()),t))})},ce=(n,o,e,t)=>{const s=n.scene,a=n.animations;t.stop(),t=new F(s.position);const i=c.localToWorld(e.clone());i.y=s.getWorldPosition(new S).y,s.lookAt(i),s.rotateY(Math.PI);const r=e.distanceTo(s.position);if(r<30){const p=r<3?3:1;t.to(e,r*p*400).start().onStart(()=>{o.stopAllAction(),o.clipAction(a[p]).play()}).onUpdate((u,g)=>{var b;const m=(b=c.getLocalInfoFromWorld(c.localToWorld(u.clone())))==null?void 0:b.point;m&&s.position.copy(c.worldToLocal(m.clone()))}).onComplete(()=>{o.stopAllAction(),o.clipAction(a[0]).play()})}else s.position.copy(e),o.stopAllAction();return t},w={mapbox:()=>{c.imgSource=x,c.reload()},google:()=>{c.imgSource=q,c.reload()},bing:()=>{c.imgSource=V,c.reload()},modelSize:.5},re=n=>{const o=new A,e=o.addFolder("环境");e.add(h.ambLight,"intensity",.1,2,.1).name("环境光强度"),e.add(h.dirLight,"intensity",.1,2,.1).name("直射光强度");const t=o.addFolder("地图源");t.add(w,"mapbox"),t.add(w,"google").name("google(有偏移)"),t.add(w,"bing").name("bing(有偏移)"),o.addFolder("控制").add(w,"modelSize",.01,2,.01).name("模型大小").onChange(a=>n.scene.scale.setScalar(a))};j(h);J(c);U(c);K(h,c);
